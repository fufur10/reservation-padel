<!-- Champ anti-spam honeypot caché -->
<input type="text" name="_honey" style="display:none">

<!-- Format CSV pour joindre un fichier récapitulatif -->
<input type="hidden" name="_format" value="csv">
<input type="hidden" name="_subject" value="Nouvelle réservation de Padel !">
<input type="hidden" name="_autoresponse" value="Merci pour votre réservation ! Nous avons bien reçu votre demande. Voici un récapitulatif de votre demande. Un fichier CSV est joint à cet e-mail.">
<input type="hidden" name="_captcha" value="false">

<!-- Bouton de soumission avec spinner -->
<div class="pt-4 text-center">
    <button id="submitBtn" type="submit" class="w-full md:w-auto bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all duration-300 transform hover:scale-105 flex items-center justify-center">
        <span id="btnText">Confirmer la réservation</span>
        <svg id="btnSpinner" class="hidden animate-spin h-5 w-5 ml-2 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"></path>
        </svg>
    </button>
</div>

<!-- Zone de récapitulatif imprimable -->
<div id="recapitulatif" class="hidden print:block p-6 text-black">
    <h2 class="text-2xl font-bold mb-4">Récapitulatif de votre réservation</h2>
    <div class="space-y-2">
        <p><strong>Nom :</strong> <span id="recapNom"></span></p>
        <p><strong>Prénom :</strong> <span id="recapPrenom"></span></p>
        <p><strong>Email :</strong> <span id="recapEmail"></span></p>
        <p><strong>Téléphone :</strong> <span id="recapTel"></span></p>
        <p><strong>Date :</strong> <span id="recapDate"></span></p>
        <p><strong>Heure :</strong> <span id="recapHeure"></span></p>
        <p><strong>Durée :</strong> <span id="recapDuree"></span></p>
        <p><strong>Nombre de joueurs :</strong> <span id="recapJoueurs"></span></p>
        <p><strong>Commentaires :</strong> <span id="recapCommentaires"></span></p>
    </div>
</div>

<!-- Script de gestion de la soumission avec feedback visuel + impression -->
<script>
const form = document.getElementById('bookingForm');
const confirmationMessage = document.getElementById('confirmationMessage');
const dateInput = document.getElementById("date");
const today = new Date().toISOString().split('T')[0];
dateInput.setAttribute('min', today);
dateInput.value = today;

const btn = document.getElementById("submitBtn");
const btnText = document.getElementById("btnText");
const btnSpinner = document.getElementById("btnSpinner");

form.addEventListener('submit', function(event) {
    event.preventDefault();

    btn.disabled = true;
    btnSpinner.classList.remove('hidden');
    btnText.textContent = "Envoi en cours...";

    const formData = new FormData(form);
    const action = "https://formsubmit.co/fufur1@gmail.com";

    // Injecte les données dans le récapitulatif
    document.getElementById('recapNom').textContent = formData.get("Nom") || "";
    document.getElementById('recapPrenom').textContent = formData.get("Prénom") || "";
    document.getElementById('recapEmail').textContent = formData.get("email") || "";
    document.getElementById('recapTel').textContent = formData.get("Téléphone") || "";
    document.getElementById('recapDate').textContent = formData.get("Date") || "";
    document.getElementById('recapHeure').textContent = formData.get("Heure") || "";
    document.getElementById('recapDuree').textContent = formData.get("Durée") || "";
    document.getElementById('recapJoueurs').textContent = formData.get("Nombre_de_joueurs") || "";
    document.getElementById('recapCommentaires').textContent = formData.get("Commentaires") || "";

    fetch(action, {
        method: 'POST',
        body: formData,
    })
    .then(response => {
        confirmationMessage.classList.remove('hidden');
        form.reset();
        dateInput.value = today;
        document.getElementById('recapitulatif').classList.remove('hidden');
        window.print();
        document.getElementById('recapitulatif').classList.add('hidden');
    })
    .catch(error => {
        console.error('Erreur réseau:', error);
        alert("Une erreur réseau s'est produite. Veuillez vérifier votre connexion.");
    })
    .finally(() => {
        btn.disabled = false;
        btnSpinner.classList.add('hidden');
        btnText.textContent = "Confirmer la réservation";
    });
});
</script>
